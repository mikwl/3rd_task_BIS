Времени ушло примерно минут 10. Ранее уже выполнял подобную задачку, когда разбирал код.

Решил обернуть всё в try except. Но по сути это было не нужно.